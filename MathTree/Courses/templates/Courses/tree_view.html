{% extends "Courses/courses_base.html" %}
{% block content_ %}

{% load static %}

<p>Bienvenue sur l'arbre de MathTree !</p>
</main>
<div id="tree_page_container">
  <div class="iFrame_container">
    <iframe id="tree_iframe"
      title="tree_iframe"
      width="99%"
      height="100%"
      src=""> 
    </iframe>
  </div>

  <div id="container"></div>
  <script type="text/javascript" src="{% static './Courses/sigma.min.js'%}"></script>
  <script type="text/javascript" src="{% static './Courses/sigma.renderers.canvas.js'%}"></script>
  <script>
      
      const data_as_string = '{{ data|escapejs }}';
      const data_as_json = JSON.parse(data_as_string)
      
      // Let's first initialize sigma:

      const s = new sigma({ 
        graph: data_as_json,
        renderer: {
          container: document.getElementById('container'),
          type: 'canvas'
        },

        settings: {
            enableEdgeHovering: true,
            edgeHoverSizeRatio: '3',
            defaultEdgeType:'line',
            defaultEdgeHoverColor: '#0000FF',
            
        }
      });
      // Finally, let's ask our sigma instance to refresh:
      s.refresh();

      s.bind('clickNode', function(e) {
        url = "/courses/general_tree_view/tree_course/"
        url += encodeURIComponent(e.data.node.id)
        document.getElementById('tree_iframe').src = url;       
      });

      s.bind('clickEdge', function(e) {
        url = "/courses/general_tree_view/tree_prerequisite/"
        url += encodeURIComponent(e.data.edge.source)
        url += "/"
        url += encodeURIComponent(e.data.edge.target)
        document.getElementById('tree_iframe').src = url;       
      });

    
    

  </script>
  </div>


{% endblock %}